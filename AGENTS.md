# AGENTS (共通テンプレート / Lean)

この AGENTS.md は **運用の最小ルール**を記載します。
詳細（レビューゲートのチェックリスト、Phase Close、spec/plan 分割ルール、DoD、エラー一覧など）は **`docs/OVERVIEW.md`** を正とします。
機密情報は記載しないでください。

## Top 5（必ず守る）
1. **入口は `docs/OVERVIEW.md`**（全体像・現在地・リンク集）。作業前後で必ず確認/更新する。
2. **正本（Canonical）は `docs/`**。迷ったらまず正本を更新する（フェーズ運用は任意・適用条件あり）。
3. **レビューゲートで必ず停止**：自己レビュー → 完成と判断できたらユーザー確認 → 合意で次へ。
4. **`docs/plan.md` は current / future / archive で管理**（current はチェックリスト、future は粗い計画、archive は完了）。
5. **大きい変更は “提案→合意→適用”**（構成変更、ID変更、大量削除、互換影響など）。

## 設計指示（必須 / 短縮版）
- **ユーザー向けI/Fは単純に**：引数・型の種類を最小化し、内部都合の型/状態を漏らさない。
- **データモデルは共通属性で集約**：似た概念のオブジェクトを乱立させず、共通属性を抽出してコアに寄せる。
- **拡張は合成で**：差分は `details/meta` 等の入れ子で表現してI/Fを安定化（ただしゴッドデータ禁止）。
- **`details/meta` のゴミ箱化禁止**：キー集合/構造は spec で定義し、「不明キー何でもOK」を許さない。肥大化したらコアへ昇格。
- **ゴッドAPI/ゴッドクラス禁止**：最小I/F・最小データで責務分割する。
- **依存方向の逆流禁止**：レイヤー責務と依存方向は architecture に明記し、それに従う。

## 作業開始 60 秒ルーチン（初動固定）
1) `docs/OVERVIEW.md`：現在フェーズ / 今回スコープ / 参照リンクを確認
2) `docs/concept.md`：対象 Spec ID と範囲を確認
3) `docs/spec.md`：該当章へ移動（必要なら分割する）
4) `docs/plan.md`：current チェックリストと詳細リンクを確認
5) （任意）フェーズ運用時のみ `docs/phases/<PHASE>/` を確認

## 更新の安全ルール（強すぎない版）
### そのまま適用してよい変更（合意不要）
- 誤字修正、リンク更新、追記（既存の意味を変えない）
- plan のチェック更新（チェックボックスの進捗）
- 既存方針に沿った小さな明確化（文章の補足）

### “提案→合意→適用” が必要な変更（事故防止）
- 大量削除、章構成の変更、ファイルの移動/リネーム
- Spec ID / Error ID の変更、互換性に影響する仕様変更
- API / データモデルの形を変える設計変更
- セキュリティ対応・重大バグ修正で挙動が変わるもの（提案は簡潔でよいが必須）

## 言語・コメント
- AGENTS.md が日本語の場合、`docs/**` は日本語で作成する
- ソースコードのコメントは **日本語 + 英語を併記**

## 言語別指針 (Python)
- Python: `uv` + `.venv` 仮想環境、`pytest`、Lint/Format（`ruff`/`black` など）を推奨。
- 環境変数/`.env` の必要キーと利用箇所を明示し、`.env.sample` は生成しないでください。

## 対応エディタ
- ターゲット: Codex
- 他のエディタ指定時は CLI オプション `--editor` を使用

## サンプル（最低限）
- 成功例: `bon --dir ./project --lang ts --editor codex`
- 失敗例: `bon --editor unknown` → `[bon][E_EDITOR_UNSUPPORTED] Unsupported editor: unknown`

## 詳細は OVERVIEW を正とする
`docs/OVERVIEW.md` を参照する。